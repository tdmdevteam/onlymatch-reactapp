server {
  listen 80;
  server_name _;

  # Frontend static build bundled in the image
  root /var/www/html/frontend;
  index index.html;

  # Single Page App fallback
  location / {
    try_files $uri /index.html;
  }

  # Forward API requests to PHP-FPM in the same container
  location /api {
    include fastcgi_params;
    fastcgi_split_path_info ^/api(/.*)$;
    fastcgi_param SCRIPT_FILENAME /var/www/html/backend/public/index.php;
    fastcgi_param SCRIPT_NAME /index.php;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param QUERY_STRING $query_string;
    fastcgi_pass 127.0.0.1:9000;
  }

  # Serve uploaded files
  location /uploads/ {
    alias /var/www/html/backend/public/uploads/;
    autoindex off;
  }
}
